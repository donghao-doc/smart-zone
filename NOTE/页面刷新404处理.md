# 页面刷新 404 处理

## 问题描述
- 路由根据菜单列表动态生成。
- 菜单列表在 `src/components/page-layout/menu-nav/MenuNav.tsx` 内请求。
- 刷新页面时，路由尚未补充完成，React Router 先匹配到 `*`，展示 404。

## 根因
- 菜单请求在 `MenuNav` 里触发，`RouterProvider` 已经开始渲染路由。
- 动态路由补丁 `addMenuRoutes` 发生在 404 已经渲染之后。

## 解决方案（最终）
### 启动前置 + Loading 守卫
- 将“拉菜单 + addMenuRoutes”前置到 `App` 启动阶段。
- 在菜单未就绪之前，仅渲染 Loading，不挂载 `RouterProvider`。
- `MenuNav` 只负责展示菜单，移除请求逻辑。
- 不缓存菜单到 storage（刷新时重新拉取菜单）。

### 实施要点
1) `src/App.tsx`
- 新增 `menuReady` 状态。
- 若未登录：直接允许渲染路由（进入登录页不依赖菜单）。
- 若已登录：请求菜单 → `setMenuList` → `addMenuRoutes` → `menuReady=true`。
- `menuReady=false` 时返回 Loading。

2) `src/components/page-layout/menu-nav/MenuNav.tsx`
- 移除 `useEffect` 菜单请求与 `addMenuRoutes` 调用。
- 仅从 store 读取 `menuList`。

3) `src/store/index.ts`
- `redux-persist` 仅保留 `user`，不持久化 `system`（菜单）。

4) UI 细节
- Loading 使用全屏居中容器（`.app-loading`）。

## 结果
- 刷新页面时不会出现 404 闪烁。
- 菜单未准备好时只显示 Loading。
- 每次刷新重新拉取菜单，不依赖 storage 缓存。
